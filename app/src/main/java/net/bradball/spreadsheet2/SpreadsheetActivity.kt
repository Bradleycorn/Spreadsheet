package net.bradball.spreadsheet2

import android.content.Context
import android.content.Intent
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.os.Parcelable
import android.util.AttributeSet
import android.util.Log
import android.view.Menu
import android.view.MenuItem
import android.view.MotionEvent
import androidx.recyclerview.widget.LinearLayoutManager
import androidx.recyclerview.widget.RecyclerView
import kotlinx.android.synthetic.main.activity_spreadsheet.*
import net.bradball.spreadsheet.MyLinearLayoutManager
import net.bradball.spreadsheet.R


class MyRecyclerView(context: Context, attrs: AttributeSet? = null, defStyle: Int) : RecyclerView(context, attrs, defStyle) {
    constructor(context: Context, attrs: AttributeSet? = null) : this(context, attrs, 0)
    constructor(context: Context) : this(context, null)
    private val TAG = "MyRecyclerView"
    var lastTouched: Any? = null
    var currentLayoutState: Parcelable? = null

    val scrollListener = object: OnScrollListener() {
            override fun onScrolled(recyclerView: RecyclerView, dx: Int, dy: Int) {
                if (recyclerView.tag == lastTouched) {
                    for (i in 0 until (layoutManager?.childCount ?: 1)) {
                        val recycler = layoutManager?.getChildAt(i)
                        if (recycler?.tag != lastTouched) {
                            recycler?.scrollBy(dx, dy)
                        }
                    }
                }
            }

            override fun onScrollStateChanged(recyclerView: RecyclerView, newState: Int) {
                if (recyclerView.tag == lastTouched) {
                    Log.d(TAG, "New State: $newState")
                    currentLayoutState = recyclerView.layoutManager?.onSaveInstanceState()
                }
            }
        }

    val touchListener = object: SimpleOnItemTouchListener() {
            override fun onInterceptTouchEvent(rv: RecyclerView, e: MotionEvent): Boolean {
                lastTouched = rv.tag
                return super.onInterceptTouchEvent(rv, e)
            }
        }



}


class SpreadsheetActivity : AppCompatActivity() {

    companion object {
        fun createIntent(context: Context): Intent = Intent(context, SpreadsheetActivity::class.java)
    }

    private val data = mapOf(
            1 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            2 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            3 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            4 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            5 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            6 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            7 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            8 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            9 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            10 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            11 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            12 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            13 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            14 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            15 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            16 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            17 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            18 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            19 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            20 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            21 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            22 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            23 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            24 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            25 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            26 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            27 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            28 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            29 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            30 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            31 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            32 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            33 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            34 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            35 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            36 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            37 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            38 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25),
            39 to listOf(1.25,2.25,3.25,4.25,5.25,6.25,7.25,8.25,9.25,10.25,11.25,12.25,13.25,14.25,15.25,16.25,17.25,18.25,19.25,20.25,21.25,22.25,23.25,24.25,25.25,26.25,27.25,28.25,29.25,30.25,31.25,32.25,33.25,34.25,35.25,36.25,37.25,38.25,39.25)
    )

    private val TAG = "SpreadsheetActivity"

    private val scrollListener = object: RecyclerView.OnScrollListener() {

    }


    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_spreadsheet)
        title = "Nested Lists"

        val headerItems = data.keys.map { it.toString() }
        val contentItems = data.values.toList()

        column_headers.layoutManager = LinearLayoutManager(this, RecyclerView.HORIZONTAL, false)
        column_headers.adapter = RecyclerAdapter(headerItems)
        row_headers.layoutManager = MyLinearLayoutManager(this, RecyclerView.VERTICAL)
        row_headers.adapter = RecyclerAdapter(headerItems)
        main_content.layoutManager = LinearLayoutManager(this, RecyclerView.VERTICAL, false)
        main_content.adapter = MainContentAdapter(contentItems) { rowRecycler ->
            rowRecycler.clearOnScrollListeners()
            rowRecycler.addOnScrollListener(main_content.scrollListener)
            rowRecycler.addOnItemTouchListener(main_content.touchListener)
            rowRecycler.layoutManager?.onRestoreInstanceState(main_content.currentLayoutState)
        }
    }
















    override fun onCreateOptionsMenu(menu: Menu?): Boolean {
        menuInflater.inflate(R.menu.options_menu, menu)
        return true
    }

    override fun onOptionsItemSelected(item: MenuItem?): Boolean {

        return when (item?.itemId) {
            R.id.switch_activity -> {
                finish()
                true
            }
            else -> super.onOptionsItemSelected(item)
        }
    }
}
